<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rizin shell | Rizin</title><meta name=keywords content="dev,rizin"><meta name=description content="Rizin shell"><meta name=author content="ret2libc"><link rel=canonical href=https://rizin.re/posts/rzshell/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://rizin.re/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rizin.re/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rizin.re/favicon-32x32.png><link rel=apple-touch-icon href=https://rizin.re/apple-touch-icon.png><link rel=mask-icon href=https://rizin.re/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link href=https://cdn.lineicons.com/2.0/LineIcons.css rel=stylesheet><link rel=stylesheet href=https://rizin.re/css/custom/rizin.min.f00018437c0f0fe081c2a5ccdb294666c6f0adc5f7ca5ce6f622496f40fc88ac.css><meta property="og:title" content="Rizin shell"><meta property="og:description" content="Rizin shell"><meta property="og:type" content="article"><meta property="og:url" content="https://rizin.re/posts/rzshell/"><meta property="og:image" content="https://rizin.re/images/rizin_preview.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-31T00:00:00+00:00"><meta property="og:site_name" content="Rizin"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rizin.re/images/rizin_preview.png"><meta name=twitter:title content="Rizin shell"><meta name=twitter:description content="Rizin shell"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://rizin.re/posts/"},{"@type":"ListItem","position":2,"name":"Rizin shell","item":"https://rizin.re/posts/rzshell/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rizin shell","name":"Rizin shell","description":"Rizin shell","keywords":["dev","rizin"],"articleBody":"Rizin is an interactive command line tool and as such it provides a nice shell, where you can execute rizin-specific commands to perform all kinds of actions like analyzing functions, getting information from a binary, showing sections and symbols, and much more.\nIt has a lot of commands that you must know in order to use it properly and for this reason we believe its shell should be as powerful and as discoverable as possible. In this post we are going to talk a bit about its basics and what we have done in Rizin to improve even further, for both users and developers (skip the Background section if you just care about the latter!).\nBackground Since the creation of radare2, the framework Rizin originally emerged from, more and more commands were added to the list of supported actions, help messages were written to help users navigate those commands and various constructs were developed to make the language recognized by the shell more and more powerful (and complicated, at times!). It is possible to execute a command and temporarily switch the architecture defined in Rizin, temporarily seek to another address in the address space, iterate over defined sections, functions or symbols, create macro, aliases and much more.\nCommands are organized in a tree, where each letter represents a node in that tree. For example, a has several sub-commands like aa, ab, af, ah, ao, av, etc. af groups yet other sub-commands, like afr, af+, af-, afl, afv, etc. You get the idea. This tree can be explored by users thanks to the ? suffix, which is used as a way to get help about commands.\n[0x00000000]\u003e afvb? Usage: afvb [idx] [name] ([type]) | afvb list base pointer based arguments, locals | afvb* same as afvb but in r2 commands | afvb [idx] [name] ([type]) define base pointer based arguments, locals | afvbj return list of base pointer based arguments, locals in JSON format | afvb- [name] delete argument/locals at the given name | afvbg [idx] [addr] define var get reference | afvbs [idx] [addr] define var set reference ? can be used alone to get the sub-commands of the root node.\n[0x00000000]\u003e ? Usage: [.][times][cmd][~grep][@[@iter]addr!size][|\u003epipe] ; ... Append '?' to any char command to get detailed help Prefix with number to repeat command N times (f.ex: 3x) | %var=value alias for 'env' command | *[?] off[=[0x]value] pointer read/write data/values (see ?v, wx, wv) | (macro arg0 arg1) manage scripting macros | .[?] [-|(m)|f|!sh|cmd] Define macro or load r2, cparse or rlang file | ,[?] [/jhr] create a dummy table import from file and query it to filter/sort | _[?] Print last output | =[?] [cmd] send/listen for remote commands (rap://, raps://, udp://, http://, \u0026lt;fd\u003e) [output truncated] | t[?] types, noreturn, signatures, C parser and more | T[?] [-] [num|msg] Text log utility (used to chat, sync, log, ...) | u[?] uname/undo seek/write | v panels mode | V visual mode (Vv = func/var anal, VV = graph mode, ...) | w[?] [str] multiple write operations | x[?] [len] alias for 'px' (print hexadecimal) | y[?] [len] [[[@]addr Yank/paste bytes from/to memory Usually the letter of the group is representative of what the sub-commands do. So p stands for “print” and pd stands for “print disassembly” and so on. After some time, it becomes much easier to navigate this structure.\nAs mentioned above, you can create statements that in one way or another modify the behaviour of a command (or multiple ones). Suppose you are analyzing a x86-32bit binary, but you know that some pieces of code will actually be executed in 64bit mode, you could do:\n[0x00006b60]\u003e s 0x6c00 [0x00006c00]\u003e e asm.bits=64 [0x00006c00]\u003e pd 2 ;-- entry.fini0: 0x00006c00 f30f1efa endbr64 0x00006c04 803d75b60100. cmp byte [section..bss], 0 ; [0x22280:1]=0 [0x00006c00]\u003e e asm.bits=32 [0x00006c00]\u003e s 0x6b60 Or you can simply apply some modifiers to the pd command with pd 2 @b:64 @0x6c00. This statement will temporarily switch asm.bits and the current seek to execute pd 2 within the right context. There are also other kinds of statements that allow you to redirect the output/error of a command to a file, or that provides a foreach-like behaviour. For example, if you want to execute a command on all segments, you could do @@iSS. Iterating over all basic blocks of all functions recognized by Rizin could be done with @@b @@F. See @? and @@? for more info.\nImprovements in Rizin shell We rewrote from scratch most of the code dealing with parsing and handling of commands, moving from a simple and scattered approach to a more centralized and uniform one. We started this effort in radare2 with what was called cfg.newshell which since then became the default shell of Rizin and has improved even further. Some of the issues we had with the previous implementation and that led to the rewrite of this code: manually written command help strings inconsistently displayed, hand-written parser with a non clear formal and global grammar defined, impossibility of dynamically registering/deregistering commands in the shell, commands handlers code mixing core logic with input handling, manually implemented autocompletion of commands and partial autocompletion of arguments. These are just some of the things we solved.\nRizin keeps track of all commands that can be executed in its shell, their place in the commands tree, the brief summary of what they do, a possibly longer description, additional details that may be useful, the number of arguments a command accepts, their types and whether they are optional.\nThis information (and more) are stored by Rizin, making it possible to write code in a uniform way. For example, the list of sub-commands available under z? is automatically generated from the data Rizin has available. Autocompletion of commands can be easily performed as soon as a developer adds a new command. Argument autocompletion is straightforward as well, because when a developer adds a new command with its arguments (and types, which are mandatory), Rizin already has all the information to perform the autocompletion.\nAlso error reporting is more uniform, because when the shell detects a non-existing command it can immediately report that to the user. It is also possible to extend this behaviour to propose similar commands that a user wanted to type or provide help for the most similar command available. Similar errors can be reported when a user uses a command in the wrong way, for example by not providing enough arguments or by providing too many. Rizin, knowing how many arguments a command accepts, can immediately return an error (and this behaviour could be extended as well to provide the help of the command, to make life easier for users).\nAnother important aspect of having a database of commands which are available to the Rizin shell is that commands can be easily registered and deregistered at runtime by Rizin plugins (e.g. rz-ghidra). Of course you want to see the commands provided by a plugin only when that plugin is actually loaded. You also want your new command, defined by an external plugin, to behave similarly to the internal commands: you want the plugin commands and their arguments to be autocompleted and you want uniform error reporting. All this is possible because these operations are all automatically performed by the Rizin shell and not by each individual command.\nWe also recognize that sometimes having just a short summary of what a command does is not enough. You would want to have a much longer description of what operations the command performs, which config variables affect its behaviour, etc. This is why we added the possibility to provide a description to each command, that can be shown by using the ?? suffix.\n[0x00000000]\u003e wv?? Usage: wv # Write value as 4-bytes/8-bytes based on value Write the number passed as argument at the current offset as a 4 - bytes value or 8 - bytes value if the input is bigger than UT32_MAX, respecting the cfg.bigendian variable Examples: | wv 0xdeadbeef # Write the value 0xdeadbeef at current offset | wv2 0xdead # Write the word 0xdead at current offset | wv1 0xde # Write the byte 0xde at current offset [0x00000000]\u003e Only a few commands have such description right now, but we very much welcome pull requests to improve our user documentation. If you want to help us, see the next section to know which files to touch.\nWe also changed the way commands and statements are parsed: instead of relying on a very simple hand-written parser, we switched to a tree-sitter based parser, where we just have to write a formal grammar and tree-sitter automatically generates the parser for us. This approach ensures that commands and their arguments are parsed in a consistent way. For example, all new commands accept quoted strings. Wrapping multiple words in single or double quotes would make the shell consider those words as a single argument for the command. If you need to pass ; as an argument of a command (semi-colons usually represent the separator between commands), you can just quote it or escape it with \\; and expect this to work for all (new) commands. Using tree-sitter and defining the grammar in a single file forced us to think about the grammar as a whole in a very uniform way across all commands and not just as the union of different grammars for each command.\nHow it works File rz_cmd.h has all the API to register, deregister, execute commands with a list of arguments and get help for a tree of commands. To add new commands, developers (of a plugin, for example) have to use rz_cmd_desc_argv_new by specifying the parent group in the commands tree, the handler of the command and a structure of type RzCmdDescHelp that describes the command: its summary, an optional longer description, a list of detailed sub-sections in the help and the list of arguments the command accept, including information on their types and whether they are optional or not.\nAs soon as the command is registered (e.g. a Core plugin with a command is loaded), the Rizin shell becomes aware of the new command: the command can now be executed, it is shown in the help tree in the right place, it is autocompleted as necessary, including its arguments. As an example, you can see rz-ghidra or jsdec.\nPlugin developers have to use all the C API and data structures mentioned above and more, included in the rz_cmd.h file. To avoid a lot of boilerplate code and make changes to commands easier also for non developers we thought about auto-generating the C structures like RzCmdDescHelp from a list of YAML files. Commands are all described in YAML files that mimics the final tree structure, like below:\n- name: tc summary: List loaded types in C format subcommands: - name: tc cname: type_list_c summary: List loaded types in C format with newlines args: - name: type type: RZ_CMD_ARG_TYPE_ANY_TYPE optional: true - name: tcc summary: Manage calling convention types subcommands: - name: tcc cname: type_cc_list summary: List all calling conventions modes: - RZ_OUTPUT_MODE_STANDARD - RZ_OUTPUT_MODE_LONG - RZ_OUTPUT_MODE_SDB - RZ_OUTPUT_MODE_RIZIN - RZ_OUTPUT_MODE_JSON args: - name: type type: RZ_CMD_ARG_TYPE_STRING optional: true - name: tcc- cname: type_cc_del summary: Remove the calling convention args: - name: type type: RZ_CMD_ARG_TYPE_STRING While building Rizin, these YAML files are used to automatically generate a .c and a .h file containing all the data structures and C API calls necessary to construct the commands tree as described by the developer.\nThis approach ensures that commands shown in the help are only those that can be executed and that commands that can be executed are listed in the help as well. In the past, due to help messages being just strings manually written for each command, it was too easy to forget to update an help message and ending with a hidden command or with a wrong help that referenced a command which did not exist anymore.\nAnother big change for developers is that commands are not implemented anymore in huge switch-cases like before, but each command handler has its own function with a signature similar to the main function of a C program, including argc/argv arguments. We believe this makes our codebase much cleaner and easier to understand, with short (and less indented) command handlers that just have to deal with the core logic of the command, without having to add boilerplate code just to parse/split arguments like it was done before.\nConclusion We think we are making big changes towards a more usable, discoverable and descriptive shell and although these changes required a lot of time, we have reached a good point. Rizin is now in a mixed state, with some commands still following the old behaviour and other commands being switched to the new way described in this blog post. We are porting new commands approximately every week, but any help is appreciated: you can provide more accurate and descriptive summaries/description to the already converted commands in https://github.com/rizinorg/rizin/tree/dev/librz/core/cmd_descs or you can help us port commands following the old structure to the new approach, so that they can benefit of everything that is explained here (look at #1342 to know which commands are missing). Have also a look at rzshell.md to know more about the shell.\nIf you have issues, bugs, ideas or want to discuss this approach or others with us, feel free to join us on Mattermost.\n","wordCount":"2233","inLanguage":"en","datePublished":"2021-12-31T00:00:00Z","dateModified":"2021-12-31T00:00:00Z","author":{"@type":"Person","name":"ret2libc"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rizin.re/posts/rzshell/"},"publisher":{"@type":"Organization","name":"Rizin","logo":{"@type":"ImageObject","url":"https://rizin.re/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>.theme-toggle{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://rizin.re/ accesskey=h>Rizin</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t title="Toggle theme"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://rizin.re/posts/ target><span>Blog</span></a></li><li><a href=https://rizin.re/organization/ target><span>Organization</span></a></li><li><a href=https://rizin.re/community/ target><span>Community</span></a></li><li><a href=https://rizin.re/gsoc/ target><span>GSoC</span></a></li><li><a href=https://cutter.re target=_blank><span>Cutter</span></a></li><li><a href=https://github.com/rizinorg/rizin target=_blank><i class="lni lni-github-original"></i>
<span>Source</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://rizin.re/>Home</a>&nbsp;»&nbsp;<a href=https://rizin.re/posts/>Posts</a></div><h1 class=post-title>Rizin shell</h1><div class=post-meta><span title='2021-12-31 00:00:00 +0000 UTC'>December 31, 2021</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;ret2libc</div></header><div class=post-content><p>Rizin is an interactive command line tool and as such it provides a nice shell, where you can execute rizin-specific commands to perform all kinds of actions like analyzing functions, getting information from a binary, showing sections and symbols, and much more.</p><p>It has a lot of commands that you must know in order to use it properly and for this reason we believe its shell should be as powerful and as discoverable as possible. In this post we are going to talk a bit about its basics and what we have done in Rizin to improve even further, for both users and developers (skip the Background section if you just care about the latter!).</p><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><p>Since the creation of radare2, the framework Rizin originally emerged from, more and more commands were added to the list of supported actions, help messages were written to help users navigate those commands and various constructs were developed to make the language recognized by the shell more and more powerful (and complicated, at times!). It is possible to execute a command and temporarily switch the architecture defined in Rizin, temporarily seek to another address in the address space, iterate over defined sections, functions or symbols, create macro, aliases and much more.</p><p>Commands are organized in a tree, where each letter represents a node in that tree. For example, <code>a</code> has several sub-commands like <code>aa</code>, <code>ab</code>, <code>af</code>, <code>ah</code>, <code>ao</code>, <code>av</code>, etc. <code>af</code> groups yet other sub-commands, like <code>afr</code>, <code>af+</code>, <code>af-</code>, <code>afl</code>, <code>afv</code>, etc. You get the idea. This tree can be explored by users thanks to the <code>?</code> suffix, which is used as a way to get help about commands.</p><pre tabindex=0><code>[0x00000000]&gt; afvb?
Usage: afvb   [idx] [name] ([type])
| afvb                        list base pointer based arguments, locals
| afvb*                       same as afvb but in r2 commands
| afvb [idx] [name] ([type])  define base pointer based arguments, locals
| afvbj                       return list of base pointer based arguments, locals in JSON format
| afvb- [name]                delete argument/locals at the given name
| afvbg [idx] [addr]          define var get reference
| afvbs [idx] [addr]          define var set reference
</code></pre><p><code>?</code> can be used alone to get the sub-commands of the root node.</p><pre tabindex=0><code>[0x00000000]&gt; ?
Usage: [.][times][cmd][~grep][@[@iter]addr!size][|&gt;pipe] ; ...
Append &#39;?&#39; to any char command to get detailed help
Prefix with number to repeat command N times (f.ex: 3x)
| %var=value              alias for &#39;env&#39; command
| *[?] off[=[0x]value]    pointer read/write data/values (see ?v, wx, wv)
| (macro arg0 arg1)       manage scripting macros
| .[?] [-|(m)|f|!sh|cmd]  Define macro or load r2, cparse or rlang file
| ,[?] [/jhr]             create a dummy table import from file and query it to filter/sort
| _[?]                    Print last output
| =[?] [cmd]              send/listen for remote commands (rap://, raps://, udp://, http://, &amp;lt;fd&gt;)
[output truncated]
| t[?]                    types, noreturn, signatures, C parser and more
| T[?] [-] [num|msg]      Text log utility (used to chat, sync, log, ...)
| u[?]                    uname/undo seek/write
| v                       panels mode
| V                       visual mode (Vv = func/var anal, VV = graph mode, ...)
| w[?] [str]              multiple write operations
| x[?] [len]              alias for &#39;px&#39; (print hexadecimal)
| y[?] [len] [[[@]addr    Yank/paste bytes from/to memory
</code></pre><p>Usually the letter of the group is representative of what the sub-commands do. So <code>p</code> stands for &ldquo;print&rdquo; and <code>pd</code> stands for &ldquo;print disassembly&rdquo; and so on. After some time, it becomes much easier to navigate this structure.</p><p>As mentioned above, you can create <em>statements</em> that in one way or another modify the behaviour of a command (or multiple ones). Suppose you are analyzing a x86-32bit binary, but you know that some pieces of code will actually be executed in 64bit mode, you could do:</p><pre tabindex=0><code>[0x00006b60]&gt; s 0x6c00
[0x00006c00]&gt; e asm.bits=64
[0x00006c00]&gt; pd 2
            ;-- entry.fini0:
            0x00006c00      f30f1efa       endbr64
            0x00006c04      803d75b60100.  cmp byte [section..bss], 0  ; [0x22280:1]=0
[0x00006c00]&gt; e asm.bits=32
[0x00006c00]&gt; s 0x6b60
</code></pre><p>Or you can simply apply some modifiers to the <code>pd</code> command with <code>pd 2 @b:64 @0x6c00</code>. This statement will temporarily switch <code>asm.bits</code> and the current seek to execute <code>pd 2</code> within the right context. There are also other kinds of statements that allow you to redirect the output/error of a command to a file, or that provides a foreach-like behaviour. For example, if you want to execute a command on all segments, you could do <code>&lt;cmd> @@iSS</code>. Iterating over all basic blocks of all functions recognized by Rizin could be done with <code>&lt;cmd> @@b @@F</code>. See <code>@?</code> and <code>@@?</code> for more info.</p><h1 id=improvements-in-rizin-shell>Improvements in Rizin shell<a hidden class=anchor aria-hidden=true href=#improvements-in-rizin-shell>#</a></h1><p>We rewrote from scratch most of the code dealing with parsing and handling of commands, moving from a simple and scattered approach to a more centralized and uniform one. We started this effort in radare2 with what was called <code>cfg.newshell</code> which since then became the default shell of Rizin and has improved even further. Some of the issues we had with the previous implementation and that led to the rewrite of this code: manually written command help strings inconsistently displayed, hand-written parser with a non clear formal and global grammar defined, impossibility of dynamically registering/deregistering commands in the shell, commands handlers code mixing core logic with input handling, manually implemented autocompletion of commands and partial autocompletion of arguments. These are just some of the things we solved.</p><p>Rizin keeps track of all commands that can be executed in its shell, their place in the commands tree, the brief summary of what they do, a possibly longer description, additional details that may be useful, the number of arguments a command accepts, their types and whether they are optional.</p><p>This information (and more) are stored by Rizin, making it possible to write code in a uniform way. For example, the list of sub-commands available under <code>z?</code> is automatically generated from the data Rizin has available. Autocompletion of commands can be easily performed as soon as a developer adds a new command. Argument autocompletion is straightforward as well, because when a developer adds a new command with its arguments (and types, which are mandatory), Rizin already has all the information to perform the autocompletion.</p><p>Also error reporting is more uniform, because when the shell detects a non-existing command it can immediately report that to the user. It is also possible to extend this behaviour to propose similar commands that a user wanted to type or provide help for the most similar command available. Similar errors can be reported when a user uses a command in the wrong way, for example by not providing enough arguments or by providing too many. Rizin, knowing how many arguments a command accepts, can immediately return an error (and this behaviour could be extended as well to provide the help of the command, to make life easier for users).</p><p>Another important aspect of having a database of commands which are available to the Rizin shell is that commands can be easily registered and deregistered at runtime by Rizin plugins (e.g. rz-ghidra). Of course you want to see the commands provided by a plugin only when that plugin is actually loaded. You also want your new command, defined by an external plugin, to behave similarly to the internal commands: you want the plugin commands and their arguments to be autocompleted and you want uniform error reporting. All this is possible because these operations are all automatically performed by the Rizin shell and not by each individual command.</p><p>We also recognize that sometimes having just a short summary of what a command does is not enough. You would want to have a much longer description of what operations the command performs, which config variables affect its behaviour, etc. This is why we added the possibility to provide a description to each command, that can be shown by using the <code>??</code> suffix.</p><pre tabindex=0><code>[0x00000000]&gt; wv??
Usage: wv &lt;value&gt;   # Write value as 4-bytes/8-bytes based on value
Write the number passed as argument at the current offset as a 4 - bytes value or 8 - bytes value if the input is bigger than UT32_MAX, respecting the cfg.bigendian variable
Examples:
| wv 0xdeadbeef # Write the value 0xdeadbeef at current offset
| wv2 0xdead    # Write the word 0xdead at current offset
| wv1 0xde      # Write the byte 0xde at current offset
[0x00000000]&gt; 
</code></pre><p>Only a few commands have such description right now, but we very much welcome pull requests to improve our user documentation. If you want to help us, see the next section to know which files to touch.</p><p>We also changed the way commands and statements are parsed: instead of relying on a very simple hand-written parser, we switched to a <a href=https://tree-sitter.github.io/tree-sitter/>tree-sitter</a> based parser, where we just have to write a formal grammar and tree-sitter automatically generates the parser for us. This approach ensures that commands and their arguments are parsed in a consistent way. For example, all new commands accept quoted strings. Wrapping multiple words in single or double quotes would make the shell consider those words as a single argument for the command. If you need to pass <code>;</code> as an argument of a command (semi-colons usually represent the separator between commands), you can just quote it or escape it with <code>\;</code> and expect this to work for all (new) commands. Using tree-sitter and defining the grammar in a single file forced us to think about the grammar as a whole in a very uniform way across all commands and not just as the union of different grammars for each command.</p><h1 id=how-it-works>How it works<a hidden class=anchor aria-hidden=true href=#how-it-works>#</a></h1><p>File <a href=https://github.com/rizinorg/rizin/blob/dev/librz/include/rz_cmd.h><code>rz_cmd.h</code></a> has all the API to register, deregister, execute commands with a list of arguments and get help for a tree of commands. To add new commands, developers (of a plugin, for example) have to use <code>rz_cmd_desc_argv_new</code> by specifying the parent group in the commands tree, the handler of the command and a structure of type <code>RzCmdDescHelp</code> that describes the command: its summary, an optional longer description, a list of detailed sub-sections in the help and the list of arguments the command accept, including information on their types and whether they are optional or not.</p><p>As soon as the command is registered (e.g. a Core plugin with a command is loaded), the Rizin shell becomes aware of the new command: the command can now be executed, it is shown in the help tree in the right place, it is autocompleted as necessary, including its arguments. As an example, you can see <a href=https://github.com/rizinorg/rz-ghidra/blob/32b82ed1d60755ad74433c706ca1a54ee7389dab/src/core_ghidra.cpp#L672>rz-ghidra</a> or <a href=https://github.com/rizinorg/jsdec/blob/master/p/core_pdd.c#L269>jsdec</a>.</p><p>Plugin developers have to use all the C API and data structures mentioned above and more, included in the <code>rz_cmd.h</code> file. To avoid a lot of boilerplate code and make changes to commands easier also for non developers we thought about auto-generating the C structures like <code>RzCmdDescHelp</code> from a list of <a href=https://github.com/rizinorg/rizin/tree/dev/librz/core/cmd_descs>YAML files</a>. Commands are all described in YAML files that mimics the final tree structure, like below:</p><pre tabindex=0><code>  - name: tc
    summary: List loaded types in C format
    subcommands:
      - name: tc
        cname: type_list_c
        summary: List loaded types in C format with newlines
        args:
          - name: type
            type: RZ_CMD_ARG_TYPE_ANY_TYPE
            optional: true
      - name: tcc
        summary: Manage calling convention types
        subcommands:
          - name: tcc
            cname: type_cc_list
            summary: List all calling conventions
            modes:
              - RZ_OUTPUT_MODE_STANDARD
              - RZ_OUTPUT_MODE_LONG
              - RZ_OUTPUT_MODE_SDB
              - RZ_OUTPUT_MODE_RIZIN
              - RZ_OUTPUT_MODE_JSON
            args:
              - name: type
                type: RZ_CMD_ARG_TYPE_STRING
                optional: true
          - name: tcc-
            cname: type_cc_del
            summary: Remove the calling convention
            args:
              - name: type
                type: RZ_CMD_ARG_TYPE_STRING
</code></pre><p>While building Rizin, these YAML files are used to automatically generate a <a href=https://github.com/rizinorg/rizin/blob/dev/librz/core/cmd_descs/cmd_descs.c>.c</a> and a <a href=https://github.com/rizinorg/rizin/blob/dev/librz/core/cmd_descs/cmd_descs.h>.h</a> file containing all the data structures and C API calls necessary to construct the commands tree as described by the developer.</p><p>This approach ensures that commands shown in the help are only those that can be executed and that commands that can be executed are listed in the help as well. In the past, due to help messages being just strings manually written for each command, it was too easy to forget to update an help message and ending with a hidden command or with a wrong help that referenced a command which did not exist anymore.</p><p>Another big change for developers is that commands are not implemented anymore in <a href=https://github.com/rizinorg/rizin/blob/6a0938574698cc80ed43bbb9594af06bb8fc4a10/librz/core/cmd/cmd_analysis.c#L1680>huge switch-cases</a> like before, but each <a href=https://github.com/rizinorg/rizin/blob/6a0938574698cc80ed43bbb9594af06bb8fc4a10/librz/core/cmd/cmd_analysis.c#L7827>command handler</a> has its own function with a signature similar to the main function of a C program, including argc/argv arguments. We believe this makes our codebase much cleaner and easier to understand, with short (and less indented) command handlers that just have to deal with the core logic of the command, without having to add <a href=https://github.com/rizinorg/rizin/blob/6a0938574698cc80ed43bbb9594af06bb8fc4a10/librz/core/cmd/cmd_analysis.c#L4461>boilerplate code</a> just to parse/split arguments like it was done before.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>We think we are making big changes towards a more usable, discoverable and descriptive shell and although these changes required a lot of time, we have reached a good point. Rizin is now in a mixed state, with some commands still following the old behaviour and other commands being switched to the new way described in this blog post. We are porting new commands approximately every week, but any help is appreciated: you can provide more accurate and descriptive summaries/description to the already converted commands in <a href=https://github.com/rizinorg/rizin/tree/dev/librz/core/cmd_descs>https://github.com/rizinorg/rizin/tree/dev/librz/core/cmd_descs</a> or you can help us port commands following the old structure to the new approach, so that they can benefit of everything that is explained here (look at <a href=https://github.com/rizinorg/rizin/issues/1342>#1342</a> to know which commands are missing). Have also a look at <a href=https://github.com/rizinorg/rizin/blob/dev/doc/rzshell.md>rzshell.md</a> to know more about the shell.</p><p>If you have issues, bugs, ideas or want to discuss this approach or others with us, feel free to join us on <a href=https://im.rizin.re/>Mattermost</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://rizin.re/tags/dev/>dev</a></li><li><a href=https://rizin.re/tags/rizin/>rizin</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Rizin shell on twitter" href="https://twitter.com/intent/tweet/?text=Rizin%20shell&amp;url=https%3a%2f%2frizin.re%2fposts%2frzshell%2f&amp;hashtags=dev%2crizin"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rizin shell on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frizin.re%2fposts%2frzshell%2f&amp;title=Rizin%20shell&amp;summary=Rizin%20shell&amp;source=https%3a%2f%2frizin.re%2fposts%2frzshell%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rizin shell on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frizin.re%2fposts%2frzshell%2f&title=Rizin%20shell"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rizin shell on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frizin.re%2fposts%2frzshell%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rizin shell on whatsapp" href="https://api.whatsapp.com/send?text=Rizin%20shell%20-%20https%3a%2f%2frizin.re%2fposts%2frzshell%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rizin shell on telegram" href="https://telegram.me/share/url?text=Rizin%20shell&amp;url=https%3a%2f%2frizin.re%2fposts%2frzshell%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://rizin.re/>Rizin</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><script defer src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>